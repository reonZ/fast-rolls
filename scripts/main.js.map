{"mappings":"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","sources":["src/main.ts","src/chat.ts","../../../../Projects/foundry-ts/utils/foundry/path.ts","src/module.ts","src/dice.ts"],"sourcesContent":["import { renderChatLog } from './chat'\r\n\r\nHooks.on('renderChatLog', renderChatLog)\r\n","import { imagePath, templatePath } from './@utils/foundry/path'\r\nimport { dice, processDie } from './dice'\r\n\r\nexport async function renderChatLog(chatLog: ChatLog, $html: JQuery) {\r\n    await injectDice($html)\r\n    addListeners($html)\r\n}\r\n\r\nasync function injectDice(html: JQuery) {\r\n    const data = {\r\n        dice: dice.map(x => ({ type: x, img: imagePath(`${x}.webp`) })),\r\n    }\r\n\r\n    const template = await renderTemplate(templatePath('dice.html'), data)\r\n    html.find('#chat-form').after(template)\r\n}\r\n\r\nfunction addListeners(html: JQuery) {\r\n    html.find('#fast-rolls-chat-dice .fast-rolls-die').on('click', processDie)\r\n}\r\n","import MODULE_ID from '~./src/module'\r\n\r\nexport function getSettingLocalizationPath(...path: string[]) {\r\n    return `${MODULE_ID}.settings.${path.join('.')}`\r\n}\r\n\r\nexport function flagsUpdatePath(...path: string[]) {\r\n    return `flags.${MODULE_ID}.${path.join('/')}`\r\n}\r\n\r\nexport function templatePath(...path: string[]) {\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n\r\nexport function imagePath(...path: string[]) {\r\n    return `modules/${MODULE_ID}/images/${path.join('/')}`\r\n}\r\n","export default 'fast-rolls'\r\n","const ROLL_REGEX = /^\\/(?:r|roll|publicroll|pr|gmroll|grm|blindroll|broll|br|selfroll|sr) (.+)/i\r\nconst INLINE_REGEX = /\\[\\[([\\dd+ -]+)\\]\\]$/i\r\n\r\nexport const dice = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'] as const\r\n\r\nexport async function processDie(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    const die = event.currentTarget.dataset.die!\r\n\r\n    if (!event.shiftKey) {\r\n        rollDie(die, event.ctrlKey)\r\n        return\r\n    }\r\n\r\n    const chat = ui.chat.element.find<HTMLTextAreaElement>('#chat-message')\r\n    const str = (chat.val() as string).trim()\r\n\r\n    if (!str) {\r\n        chat.val(`/r 1${die}`)\r\n        return\r\n    }\r\n\r\n    if (ROLL_REGEX.test(str)) {\r\n        chat.val(processChatRoll(die, str))\r\n        return\r\n    }\r\n\r\n    const match = str.match(INLINE_REGEX)\r\n    if (!match) {\r\n        chat.val(str + ` [[1${die}]]`)\r\n        return\r\n    }\r\n\r\n    const index = match.index!\r\n    const sub = str.substring(index + 2, str.length - 2).trim()\r\n    const newStr = str.substring(0, index) + '[[' + processChatRoll(die, sub) + ']]'\r\n    chat.val(newStr)\r\n}\r\n\r\nfunction processChatRoll(die: string, str: string) {\r\n    const DIE_REGEX = new RegExp(`(?<!- *)(\\\\d+)${die}`, 'i')\r\n    const match = str.match(DIE_REGEX)\r\n\r\n    if (!match) return str + ` + 1${die}`\r\n\r\n    const index = match.index!\r\n    const value = Number(match[1])\r\n\r\n    return str.substring(0, index) + (value + 1) + str.substring(index + 1)\r\n}\r\n\r\nasync function rollDie(die: string, ctrlKey: boolean) {\r\n    const roll = new Roll(`1${die}`)\r\n    const rollMode = ctrlKey ? CONST.DICE_ROLL_MODES.BLIND : CONST.DICE_ROLL_MODES.PUBLIC\r\n    await roll.evaluate({ async: true })\r\n    roll.toMessage({}, { rollMode })\r\n}\r\n"],"names":[],"version":3,"file":"main.js.map"}